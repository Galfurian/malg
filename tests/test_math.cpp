#include "malg/matrix.hpp"
#include "malg/linalg.hpp"
#include "malg/math.hpp"
#include "malg/io.hpp"

int test_int()
{
    // Input.
    const malg::Matrix<int> a = {
        { -77, 43, 81, -60, -33 },
        { -95, -40, 14, 41, 13 },
        { 0, 41, 93, -89, -17 },
        { -60, 1, -74, -53, 69 },
        { -9, 10, -89, 30, -72 }
    };
    const malg::Matrix<int> b = {
        { 67, 38, 34, 88, 28 },
        { 0, -12, -12, 42, -69 },
        { 20, -54, 15, -27, -20 },
        { 77, 16, 54, -18, 18 },
        { -8, 93, 88, -40, -9 }
    };
    // Reference.
    const malg::Matrix<int> sum = {
        { -10, 81, 115, 28, -5 },
        { -95, -52, 2, 83, -56 },
        { 20, -13, 108, -116, -37 },
        { 17, 17, -20, -71, 87 },
        { -17, 103, -1, -10, -81 }
    };
    const malg::Matrix<int> sub = {
        { -144, 5, 47, -148, -61 },
        { -95, -28, 26, -1, 82 },
        { -20, 95, 78, -62, 3 },
        { -137, -15, -128, -35, 51 },
        { -1, -83, -177, 70, -63 }
    };
    const malg::Matrix<int> mul = {
        { -7895, -11845, -8063, -4757, -7526 },
        { -3032, -2021, 818, -11676, 441 },
        { -4857, -8519, -5399, 1493, -6138 },
        { -10133, 7273, 48, -5046, -1844 },
        { 503, -1872, -6477, 4371, 2026 }
    };
    const malg::Matrix<double> div = {
        { -0.724101333, 0.959172965, -3.50660292, 3.52737442, -3.30035297 },
        { -3.87515054, 3.01491411, -6.44053984, 7.70150764, -2.09035033 },
        { 0.609014897, 0.368501698, -1.70527853, -0.311900352, -2.16473747 },
        { 1.87805156, 1.93870341, 2.98797968, -0.462939925, 1.27233358 },
        { 2.98660079, -4.03525548, 5.63094744, -3.59205073, 1.89608685 }
    };
    // Set the tollerance, specifically for div.
    feq::tolerance() = 1e-06;
    // Check the operations.
    if (!malg::all((a + b) == sum))
        return 1;
    if (!malg::all((a - b) == sub))
        return 1;
    if (!malg::all((a * b) == mul))
        return 1;
    if (!malg::all(malg::linalg::div(a, b) == div))
        return 1;
    return 0;
}

int test_double()
{
    // Input.
    const malg::Matrix<double> a = {
        { -37.2013365, -68.6581972, 41.3047901, 39.1891392, -83.7775724 },
        { -29.4343112, 19.2121221, -92.9539817, 79.2170016, 87.7778305 },
        { -17.6058458, -4.69375854, 22.4131617, 67.8548823, -72.9728209 },
        { 82.8826396, -23.414967, -63.2745926, 99.0710991, -39.0158564 },
        { -32.7507545, -20.9186668, -0.269948579, 27.4472885, -97.0661874 }
    };
    const malg::Matrix<double> b = {
        { -37.4315122, -46.8778636, 98.621834, 64.875136, -82.3723058 },
        { -19.5194821, -29.6733099, 27.642446, -66.8425277, 18.3564081 },
        { -56.4430537, -85.474696, 44.795422, 44.2905858, -2.45158714 },
        { 27.0582983, -64.0869579, 11.8315765, 58.6659616, -95.9791052 },
        { -33.592816, 37.7442705, 6.9947062, 90.3429215, 9.45861974 }
    };
    // Reference.
    const malg::Matrix<double> sum = {
        { -74.6328488, -115.536061, 139.926624, 104.064275, -166.149878 },
        { -48.9537934, -10.4611878, -65.3115357, 12.374474, 106.134239 },
        { -74.0488995, -90.1684545, 67.2085837, 112.145468, -75.424408 },
        { 109.940938, -87.501925, -51.4430161, 157.737061, -134.994962 },
        { -66.3435705, 16.8256037, 6.72475762, 117.79021, -87.6075677 }
    };
    const malg::Matrix<double> sub = {
        { 0.230175709, -21.7803337, -57.3170439, -25.6859969, -1.40526653 },
        { -9.91482914, 48.885432, -120.596428, 146.059529, 69.4214224 },
        { 38.8372079, 80.7809375, -22.3822602, 23.5642965, -70.5212337 },
        { 55.8243412, 40.6719909, -75.1061691, 40.4051375, 56.9632487 },
        { 0.84206149, -58.6629372, -7.26465478, -62.8956329, -106.524807 }
    };
    const malg::Matrix<double> mul = {
        { 4276.02224, -5422.91529, -3838.80925, -1264.38308, -2850.97902 },
        { 5168.13944, 6991.27723, -4984.46639, 5266.71917, -3767.79738 },
        { 3772.96607, -8054.07327, -569.653942, -2447.5528, -5893.7473 },
        { 4917.38457, -5603.97532, 5591.64172, 6426.96416, -16979.7172 },
        { 5652.87203, -3243.6204, -4174.47982, -7897.43065, -1238.05296 }
    };
    const malg::Matrix<double> div = {
        { -1.75792991, 7.4526154, -1.77961696, 4.36930452, 5.24532028 },
        { -1.84669495, 1.44407952, 0.432614559, 1.16256939, 2.3043699 },
        { -1.14684653, 5.19297263, -1.67231909, 3.19086747, 4.16458535 },
        { 1.58260119, -9.06219024, 2.47852257, -3.32018408, -5.80381381 },
        { -4.05907923, 15.0937256, -4.35863652, 8.57273315, 10.9560582 }
    };
    // Set the tollerance, specifically for div.
    feq::tolerance() = 1e-06;
    // Check the operations.
    if (!malg::all((a + b) == sum))
        return 1;
    if (!malg::all((a - b) == sub))
        return 1;
    if (!malg::all((a * b) == mul))
        return 1;
    if (!malg::all(malg::linalg::div(a, b) == div))
        return 1;
    return 0;
}

int test_complex()
{
    using namespace std::complex_literals;
    // Input.
    const malg::Matrix<std::complex<double>> a = {
        { 6.21972047 + 55.6003688i, -62.0717653 - 9.29039483i, -79.2333101 + 25.5526935i, 70.1014075 - 15.4969014i, 32.7315868 + 79.1097553i },
        { 7.51023105 + 3.64680008i, 63.7374363 + 43.92121i, 36.9210945 - 56.4619748i, -20.2259046 + 73.9420527i, 48.0314307 + 22.4845855i },
        { 10.9792993 + 19.9594746i, 79.8537074 + 55.1074495i, 83.2460263 - 63.3195366i, -58.0035035 + 95.0898121i, 98.1701286 - 18.5235781i },
        { -46.0580658 - 92.6997876i, -97.3461191 - 8.6252516i, 87.8804822 - 57.8865619i, 3.50403728 + 47.7014354i, -15.613705 + 24.7798349i },
        { 67.6734711 + 56.103517i, -26.3088772 + 48.460602i, 70.6932588 - 79.7588588i, -85.9500325 + 35.6230139i, -11.8113297 + 78.4160521i }
    };
    const malg::Matrix<std::complex<double>> b = {
        { 37.6463194 + 55.5178134i, -18.4074263 - 65.6354342i, 11.291236 + 19.5497491i, 26.5698575 - 96.6589965i, -31.1807715 - 81.1488153i },
        { 27.0583953 + 15.5557727i, 41.347285 - 49.2771551i, -86.1100143 - 8.4328456i, -91.8965878 + 97.7787111i, -46.1050965 + 47.456248i },
        { 25.6042146 + 53.7801993i, -40.6112622 + 9.19292961i, 2.85852944 + 2.69556217i, 97.6854439 - 0.892334903i, 12.801631 - 12.0367261i },
        { -45.3993398 + 85.3966666i, 74.6956836 - 29.4508223i, 51.8387618 - 51.7090829i, 81.4358985 - 69.3236742i, 58.2171779 - 7.16924139i },
        { -69.3605792 + 48.1518686i, 39.8427618 + 51.2287156i, -27.0086001 + 30.983493i, 90.1640195 - 84.6278121i, -59.2749554 - 68.5078407i }
    };
    // Reference.
    const malg::Matrix<std::complex<double>> sum = {
        { 43.8660398 + 111.118182i, -80.4791916 - 74.9258291i, -67.942074 + 45.1024427i, 96.671265 - 112.155898i, 1.55081528 - 2.03905996i },
        { 34.5686264 + 19.2025728i, 105.084721 - 5.3559451i, -49.1889198 - 64.8948204i, -112.122492 + 171.720764i, 1.92633415 + 69.9408335i },
        { 36.5835139 + 73.7396739i, 39.2424452 + 64.3003792i, 86.1045557 - 60.6239744i, 39.6819404 + 94.1974772i, 110.97176 - 30.5603042i },
        { -91.4574056 - 7.30312099i, -22.6504355 - 38.0760739i, 139.719244 - 109.595645i, 84.9399358 - 21.6222388i, 42.6034729 + 17.6105935i },
        { -1.68710806 + 104.255386i, 13.5338845 + 99.6893176i, 43.6846587 - 48.7753658i, 4.21398695 - 49.0047983i, -71.0862851 + 9.90821134i }
    };
    const malg::Matrix<std::complex<double>> sub = {
        { -31.4265989 + 0.0825553932i, -43.6643391 + 56.3450394i, -90.5245461 + 6.00294437i, 43.5315499 + 81.1620951i, 63.9123582 + 160.258571i },
        { -19.5481643 - 11.9089726i, 22.3901514 + 93.1983651i, 123.031109 - 48.0291292i, 71.6706833 - 23.8366585i, 94.1365272 - 24.9716626i },
        { -14.6249152 - 33.8207247i, 120.46497 + 45.9145199i, 80.3874968 - 66.0150988i, -155.688947 + 95.982147i, 85.3684976 - 6.48685207i },
        { -0.658726072 - 178.096454i, -172.041803 + 20.8255707i, 36.0417204 - 6.177479i, -77.9318612 + 117.02511i, -73.830883 + 31.9490763i },
        { 137.03405 + 7.95164839i, -66.151639 - 2.76811362i, 97.7018589 - 110.742352i, -176.114052 + 120.250826i, 47.4636257 + 146.923893i }
    };
    const malg::Matrix<std::complex<double>> mul = {
        { -15729.3783 + 393.534741i, 5524.72444 + 1083.43283i, 3452.0503 - 3618.4312i, 18715.5456 - 3531.4511i, 14363.4158 - 11811.2754i },
        { -4706.7783 - 1056.76389i, 5349.15112 + 10222.821i, -4065.73103 + 1566.41267i, 3668.84828 + 1404.63678i, -7122.24205 - 1064.22327i },
        { -5258.73983 + 3691.5543i, 7654.7563 + 13694.4559i, -6436.41659 + 6535.30201i, 6721.99659 - 2260.14522i, -14499.1048 - 1752.82647i },
        { 1933.13282 - 8887.39193i, -12948.3454 + 15975.7617i, 12311.3721 + 826.480396i, 12419.5692 - 5272.63418i, 2408.46411 + 2959.91843i },
        { 1970.03643 - 6433.90808i, -8259.55967 + 9426.04534i, -1965.60586 + 1775.14428i, 12776.1178 - 3001.52339i, 2624.64344 - 13744.6046i }
    };
    const malg::Matrix<std::complex<double>> div = {
        { -2.61040517 - 0.51938165i, -0.86673903 - 1.64601849i, 0.103491678 + 0.796748593i, 0.314309467 - 2.28212603i, 1.47281764 - 0.731910495i },
        { 0.546504938 + 0.924958461i, 0.502346129 + 1.28819315i, 0.94023401 - 0.537185686i, -0.280741161 + 1.18529653i, -1.2076058 + 0.0729997121i },
        { 1.15521647 + 2.4762995i, 0.0113777518 + 2.59992251i, 1.62600223 - 0.265827624i, -1.43559827 + 1.79784449i, -2.2968276 - 0.378406349i },
        { 0.477587767 - 2.40854546i, 0.179103912 - 0.638206495i, -0.891307585 + 0.400488878i, 1.53100862 + 0.408404799i, 0.0222926676 + 1.29257084i },
        { -0.223354037 + 0.0842494207i, -0.0380571152 + 1.29062814i, 1.74043017 + 0.253183147i, -0.360988464 + 0.553631548i, -1.07908079 - 0.559970571i }
    };

    // Set the tollerance, specifically for div.
    feq::tolerance() = 1e-06;
    // Check the operations.
    if (!malg::all((a + b) == sum))
        return 1;
    if (!malg::all((a - b) == sub))
        return 1;
    if (!malg::all((a * b) == mul))
        return 1;
    if (!malg::all(malg::linalg::div(a, b) == div))
        return 1;
    return 0;
}

int main(int, char *[])
{
    if (test_int())
        return 1;
    if (test_double())
        return 1;
    if (test_complex())
        return 1;
    return 0;
}
